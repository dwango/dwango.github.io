<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="generator" content="Hugo 0.87.0" />

  <meta property="og:title" content="『ニコニコ漫画』『読書メーター』スマートフォンアプリについて【トリスタinside出張版】 - dwango on GitHub">

  <meta property="og:image" content="https://dwango.github.io/images/trista-inside/ogp.png">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@dwango_engcom">
  <meta name="twitter:creator" content="@dwango_engcom">


  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>『ニコニコ漫画』『読書メーター』スマートフォンアプリについて【トリスタinside出張版】 - dwango on GitHub</title>

  
  <link rel="stylesheet" href="https://dwango.github.io/css/print.css" media="print">
  <link rel="stylesheet" href="https://dwango.github.io/css/poole.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="dwango on GitHub" />
</head>

  <body class="theme-dwango ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1><a href="https://dwango.github.io/">dwango on GitHub</a></h1>
    </div>

    <ul class="sidebar-nav">
      <li><a href="https://dwango.github.io/">Home</a></li>
      <li><a href="/articles"> Articles </a></li><li><a href="/niconico"> ニコニコ開発者向け情報 </a></li><li><a href="https://dwango.co.jp/"> 会社情報 </a></li><li><a href="https://recruit.dwango.co.jp/"> 採用情報 </a></li>
    </ul>

    <h2>Links</h2>
    <ul class="sidebar-nav">
      <li><a href="https://dwango.github.io/oss"> dwango OSS </a></li><li><a href="https://blog.nnn.dev/"> 教育サービス開発者ブログ </a></li><li><a href="https://vrm.dev/"> VRM </a></li><li><a href="https://dmv.nico/ja/"> Dwango Media Village </a></li>
    </ul>

    <p class="copyright">
      
        Copyright &copy; DWANGO Co., Ltd.
      
    </p>
  </div>
</div>

    <main class="content container">
    
  <div class="post">
    <time class="content-date" datetime="2018-09-27 17:00:00 &#43;0900 JST" itemprop="datepublished"
      >2018-09-27 Thu</time
    >
    <h1 class="article-title">『ニコニコ漫画』『読書メーター』スマートフォンアプリについて【トリスタinside出張版】</h1>

    <div>
      
      <article id="content"><p>　はじめまして。トリスタアプリ開発セクションの<a href="https://twitter.com/tukiyo320">tukiyo</a>です。普段はAndroidアプリの開発を行っています。</p>
<p>　このブログの読者の皆さんには、「トリスタ」という名前に聞き覚えがないかもしれませんのでご紹介させていただきますと、<a href="https://trista.jp/">株式会社トリスタ</a>は『ニコニコ漫画』『読書メーター』など、本にまつわる事業を担うカドカワのグループ会社です。私を含め、メンバーの大半はドワンゴの社員でもあります。</p>
<p>　実は先日、トリスタでもブログ「<a href="https://inside.trista.jp/">トリスタinside</a>」を始めました。今回はトリスタの紹介と、ブログの宣伝……だけでは物足りないので、こちらのブログにも私が書いた記事を掲載させていただくことになりました。内容はほぼ変わらないので、元記事でお読みになる方は<a href="https://inside.trista.jp/tukiyo/419bf8e0fa01e8bf1f3f1a70244a358d">こちら</a>からどうぞ！</p>
<p>　本記事では、トリスタで提供しているスマートフォンアプリのうち、『ニコニコ漫画』と『読書メーター』がどのように作られているか概説します。より詳細な内容については別の機会に譲り、今回は触りの部分だけ紹介します。自分の担当であるAndroidを中心として話を進めていきますが、両プラットフォーム共通の取り組みなどにも触れていきたいと思います。</p>
<p>　以下を読むにあたって、『ニコニコ漫画』（2015年リリース）の後に『読書メーター』（2017年リリース）が開発された、という変遷を念頭に置いておくと、理解の助けになるでしょう。</p>
<h1 id="ニコニコ漫画">ニコニコ漫画</h1>
<div class="article-img">
  
  <img src="https://dwango.github.io/images/trista-inside/nicomanga_app.png" alt="ニコニコ漫画アプリ"  />
  
</div>

<ul>
<li><a href="https://site.nicovideo.jp/nicomanga/">アプリ紹介ページ</a></li>
<li><a href="https://play.google.com/store/apps/details?id=jp.co.dwango.seiga.manga.android&amp;hl=ja">AppStore</a></li>
<li><a href="https://itunes.apple.com/jp/app/%E3%83%8B%E3%82%B3%E3%83%8B%E3%82%B3%E6%BC%AB%E7%94%BB-%E9%9B%91%E8%AA%8C%E3%82%84web%E3%81%AE%E4%BA%BA%E6%B0%97%E3%83%9E%E3%83%B3%E3%82%AC%E3%81%8C%E8%AA%AD%E3%82%81%E3%82%8B/id1045938821?mt=8">PlayStore</a></li>
</ul>
<h2 id="どんなアプリ">どんなアプリ？</h2>
<blockquote>
<p>ニコニコ漫画は雑誌やWEBで話題のマンガを読める「niconico」の漫画アプリです。<br>
作品数は国内最大級、毎日いろんなマンガが楽しめる。ここでしか読めない作品を思う存分楽しもう！<br>
(AppStore)</p>
</blockquote>
<p>　雑誌連載作品のみならず、ユーザーの制作された多数の漫画がコメント付きで楽しめるのがニコニコ漫画です。最近大きく盛り上がっている異世界系作品を始めとして、他サービスには見られない独特の作品層を形成しています。ここから商業デビューを果たしたりアニメ化した作品もあるなど、魅力的な漫画が満載です。</p>
<p>　特徴的なのは漫画ビュアーで、前述の通りニコニコらしい流れるコメントはもちろんのこと、縦スクロールしているだけで見開きページがシームレスに見れたり、紙芝居のように編集された音声つきの形式（ニコニコ形式）が読めたり、新感覚の漫画読書体験を提供する大きな柱を担っています。</p>
<p>　ニコニコ漫画サービス自体は2010年からあるサービスですが、2015年秋にAndroid,iOS共にスマートフォンアプリが公開される運びとなりました。つまり執筆現在でもうじき3歳になるアプリなわけですが、ありがたいことにストアでも温かい評価をいただいておりまして、おかげでさまで今もすくすく元気に育っております。</p>
<p>　では、アプリの詳細について触れていきましょう。</p>
<h2 id="使用言語">使用言語</h2>
<p>　iOSでは全て <strong>Swift</strong>で、Androidでは <strong>Java</strong>と <strong>Kotlin</strong>が半々となっています。</p>
<p>　Swiftはモダンな言語を求めて当初から採用していました(当時ver1.2)。ただ、後にバージョンアップデートへの追従作業が待ち受けていたわけですが、後続の読書メーターアプリではこれを重く見て <strong>Xamarin(C#)</strong> を採用しています。</p>
<p>　Androidは開発開始時点でちょうど現在便利に使われている様々なツールの黎明期でもありました。言語もその１つであり、現在進行系でKotlinへの書き換え作業を行っています。執筆現在ではActivityやFragmentといったUI層と、Repository層の書き換えの大半が完了しており、保守や機能追加により柔軟に対応できる体制を整えています。本当はEntityの類こそKotlin移行（特にnullableの導入）で最も恩恵を得られる場所かとは思うのですが、そうであるが故に慎重にならざるを得ないのが辛いところです。</p>
<h2 id="アーキテクチャandroid">アーキテクチャ（Android)</h2>
<p>　現在は <strong>MVVM</strong>をDatabindingと共に採用しています。ニコニコ漫画アプリではユーザー入力とその反映はそこまで複雑でも多くもないのですが、採用した読書メーターでの感触のよさをフィードバックしました。ちょうどKotlinの書き直しの流れに乗った形になりますが、Architecture Componentsはまだ様子見の段階であったために採用は見送り、自前のViewModelを利用しています。</p>
<h2 id="reactive-programming">Reactive Programming</h2>
<p>　iOSでは <strong>RxSwift</strong>と <strong>RxCocoa</strong> を、Androidでは <strong>RxJava</strong>と <strong>RxLifecycle</strong>を用い、Reactive Programmingを取り入れた開発を行っています。この開発に携わる前までは座禅を組んだ犬がいることしか知らなかった私ですが、RxJava 2.xへの対応も終え、APIリクエストにイベント伝播に、と今ではRxを手放せません。</p>
<p>　AndroidでMVVMとRxを組み合わせたとき特有の、プロパティの変更イベントをいい感じに扱ったり直接Viewに反映させたい悩みに対しては、漫画アプリではObservableFieldを少し拡張し、RxJavaを利用してObservableとの相互変換を実現するライブラリを作って使用することで解決しています。似たようなライブラリに<strong>RxProperty</strong>がありますが、こちらはそれと比較して軽量であることを志向しています。</p>
<h2 id="見開き表示">見開き表示</h2>
<p>　電子書籍リーダーで漫画を読む際、難点の１つが『見開きページの感動が薄れる』ことではないでしょうか。見開きが左右に分割されて２ページ扱いになって、行ったり来たりしないと見れないことはとてもストレスであり、分かたれるべきではないページが分かれる表示は作者の意図に沿っているとも言い難いです。</p>
<p>　ニコニコ漫画のスクロール形式ビュアーは縦スクロールでページが上下に流れていく形式なのですが、見開きを考慮しない場合、見開きページの右半分の下に見開きページの左半分が表示される、なんとも悲しい表示になることでしょう。そこを我々は、『縦スクロールをすると見開きページだけ左右にスクロールされているように見える』という機能<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>を搭載することで解決しています。</p>
<p>　実際に見開き表示を確認してみたい方は、アプリから <a href="http://seiga.nicovideo.jp/watch/mg253127">幻想武姫ナガシノ</a> などでお確かめください。</p>
<p>　見開きの間だけ無理やり横スクロールさせているわけではなく、スクロール量に応じて見開き原稿のほうを適切に動かすことで実現をしています。これにより、主人公がキメている見開きも、タイトルページのカラー見開きも、指を上下に動かすだけでシームレスに読むことができます。</p>
<h1 id="読書メーター">読書メーター</h1>
<div class="article-img">
  
  <img src="https://dwango.github.io/images/trista-inside/bookmeter_app.png" alt="読書メーターアプリ"  />
  
</div>

<ul>
<li><a href="https://bookmeter.com/specials/app">アプリ紹介ページ</a></li>
<li><a href="https://itunes.apple.com/jp/app/%E8%AA%AD%E6%9B%B8%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%BC-%E6%97%A5%E3%80%85%E3%81%AE%E8%AA%AD%E6%9B%B8%E8%A8%98%E9%8C%B2%E3%81%A8%E8%AA%AD%E6%9B%B8%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3/id509979590?mt=8">AppStore</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.bookmeter.android&amp;hl=ja">PlayStore</a></li>
</ul>
<h2 id="どんなアプリ-1">どんなアプリ？</h2>
<blockquote>
<p>読書メーターは日々の読書量を簡単に記録・管理できるアプリです。グラフや、本棚、1,800万件を超える感想・レビューも。新たな本との出会いや読書仲間とのつながりが、読書をもっと楽しくします。<br>
(AppStore)</p>
</blockquote>
<p>　2008年に開始された、読書記録管理＆コミュニティサイトが読書メーターです。読んだ本や読みたい本の管理を行うことができる他、自分が読んだ本に、他の人が似た感想を抱いていたり、あるいは異なる視点の人とコメントで意見を交わしたり、本を介したコミュニケーションを行うことができます。</p>
<p>　扱っている本は自動的に増えていくのですが、商業出版されていないオリジナル本は自分で登録できます。私も自分が書いた本を登録していて（大半はいつの間にか読者の方が登録してくださっているのですが）、『自分が読んだ本と同じ本を読んだ人の感想が表示される』という共読機能により、自分の本の感想が勝手に流れてくるという最高の著者体験をユーザーの一人として享受しています。</p>
<p>　PC版SP版がリニューアルされて今の姿になる以前からiOSアプリも存在していたのですが、Android版の開発に合わせて5年ぶりの全面リニューアルを行っています。どちらも2017年秋に公開されました。</p>
<h2 id="ios版開発">iOS版開発</h2>
<p>　iOSは前述の通り、 <strong>Xamarin.iOS</strong>で開発されています。実は旧バージョンはTitaniumで作られていたので、時を越えて同様のクロスプラットフォームフレームワークが採用されたことになります。……が、これもまた時を越えて同様に、Androidとの同一ソースを試みたわけではありませんでした。</p>
<p>　本項については以下の記事が詳しいので、そちらをお読みいただければよいかと思います。</p>
<blockquote>
<p>読書メーターiOSアプリにおける Xamarin.iOS 導入事例のご紹介<br>
<a href="https://qiita.com/gomi_ningen/items/ce20176d86276fce71e3">https://qiita.com/gomi_ningen/items/ce20176d86276fce71e3</a></p>
</blockquote>
<h2 id="ニコニコ漫画の知見を活かして">ニコニコ漫画の知見を活かして</h2>
<p>　Xamarinの選択を始め、Reactive Programmingの導入やAndroidにおける100％ Kotlin開発など、ニコニコ漫画アプリ開発で得られた知見やよい技術はそのまま活かしています。車輪の再発明もしないよう、普遍的なviewについてはたとえば以下のようなライブラリに切り出して利用しています。</p>
<ul>
<li><a href="https://github.com/chuross/extra-textview">https://github.com/chuross/extra-textview</a></li>
<li><a href="https://github.com/chuross/recyclerview-adapters">https://github.com/chuross/recyclerview-adapters</a></li>
</ul>
<h2 id="アーキテクチャandroid-1">アーキテクチャ（Android)</h2>
<p>　読書メーターからMVVMを採用しています。Databindingのお供には <a href="https://github.com/k-kagurazaka/rx-property-android">RxProperty</a> を使い、ユーザー入力の多いSNS系アプリをスマートに開発できました。APIから得られた値をViewModelのプロパティにsetするだけで、適宜加工されたmodelがよしなにリストに反映されたり、複数の入力状態に依存するボタンの状態を全てstreamで表現できたりと、とても恩恵を受けています。</p>
<p>　また読書メーターでは、ユーザーの投稿した感想やつぶやきに「いいね!」をつけることができます。それを始めとした状態の効率的伝播のために、イベント回りは <a href="https://github.com/MFlisar/RxBus2">RxBus2</a> に任せています。もちろん、通知が欲しい画面が任意に購読すればいい代わりに、グローバルなイベントになってしまうので一長一短ですが、適宜イベント用のinterfaceを切ることで秩序を保っています。</p>
<h2 id="swagger">Swagger</h2>
<p>　読書メーターでの技術採用事例で最も開発に寄与しているものといえば、このSwaggerでしょう。読書メーター両アプリでは、APIサーバーより提供されるAPI定義ファイルから、
<a href="https://github.com/swagger-api/swagger-codegen">swagger-codegen</a> を使って自動生成されたAPIクライアントライブラリを利用することで、大幅な工数の削減、機能開発への注力を実現しています。アプリ用にAPIを提供してもらっていることも相まって、いわゆるData層には、ライブラリのメソッドを呼ぶだけで終わるRepositoryがほとんどです。</p>
<p>　結合が完了するまでのAPIが未完成の状態で、Swaggerは特に力を発揮します。読書メーターは先にPC版SP版のリニューアルが行われていて、既存APIもSwaggerによるAPI定義が見られる状態だったため、</p>
<ul>
<li>既存のAPI定義を参考に、アプリチームがアプリ用APIのSwaggerファイルを書く</li>
<li>Pull Requestを出して、必要ならサーバーチームとも議論
<ul>
<li>この際、コード生成できるvalidな状態かCIでチェック</li>
</ul>
</li>
<li>マージされる
<ul>
<li>CIがコード生成して社内リポジトリ(artifactory)にSNAPSHOTとしてpublish</li>
<li>CIが最新のAPI定義を使ってモックサーバーを立てる(with <a href="https://github.com/mobilcom-debitel/pokemock">pokemock</a>)</li>
</ul>
</li>
<li>手元で依存解決して、新しくできたAPI用のメソッドを呼ぶ</li>
</ul>
<p>という流れができあがっていました。Swagger定義も複数人開発に対応できるように、ファイル分割して記述できるようもしていたため、アプリチームのメンバーが自分で足りないAPIのモックを作って開発を進める、ということが可能になっていました。</p>
<p>　結合も、モックに向けられたSNAPSHOTライブラリのメソッドから、次々できあがっていくアプリAPIから自動でpublishされてくるライブラリのメソッドに向け直すだけで済むのでとてもスムーズ<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>です。何かの間違いでAPIの認識が食い違っていても、それはAPI定義から生まれるインタフェースの違いという形で現れるので、コンパイラが怒ってくれます。</p>
<p>　これのおかげで、高い品質のアプリをリリースするための時間が生まれたと言っても過言ではありません。codegenのKotlin版はまだ発展途上ではありますが、Java版であっても十分利用する価値があります<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>。途中から入れるには少々ハードルが高いので、ニコニコ漫画では自前でAPIクライアントを書いているのですが、読書メーター開発後はもどかしい気持ちに苛まれています。</p>
<h1 id="まとめ">まとめ</h1>
<p>　触りだけとなりましたが、『ニコニコ漫画』『読書メーター』のスマートフォンアプリがどのように作られているかについての紹介でした。今後は、トリスタinside本体のほうで、より具体的な内容に言及していければと思います。</p>
<h1 id="宣伝">宣伝</h1>
<p>　トリスタでは、本が好きなスマートフォンアプリエンジニアを募集しています。</p>
<p>　<a href="https://progres05.jposting.net/pgdwango/u/job.phtml?job_code=1531">採用情報</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://ipforce.jp/patent-jp-B9-6133963">特許</a>取得済み。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>これを見越して、モック用のライブラリはパッケージを同一に、idを別にしておく必要がありました。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>swagger-codegenは現在open API specification v3.x未対応の他、fork実装として <a href="https://github.com/OpenAPITools">OpenAPI Generator</a>も出てきたため、今後の動向が注目されます。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
</article>
    </div>
    <div class="content-info">
      <div class="post-categories">
        
      </div>

      <div class="post-tags">
        
      </div>
      <div class="share">
        <a
          href="https://twitter.com/share?ref_src=twsrc%5Etfw"
          class="twitter-share-button"
          data-text="『ニコニコ漫画』『読書メーター』スマートフォンアプリについて【トリスタinside出張版】 - dwango on GitHub"
          data-url="https://dwango.github.io/articles/trista-inside/"
          data-show-count="false"
          >Tweet</a
        >      <script
        async
        src="https://platform.twitter.com/widgets.js"
        charset="utf-8"
      ></script>
      <a
        href="http://b.hatena.ne.jp/entry/https://dwango.github.io/articles/trista-inside/"
        class="hatena-bookmark-button"
        data-hatena-bookmark-layout="basic-label-counter"
        data-hatena-bookmark-lang="ja"
        title="このエントリーをはてなブックマークに追加"
        ><img
          src="https://b.st-hatena.com/images/entry-button/button-only@2x.png"
          alt="このエントリーをはてなブックマークに追加"
          width="20"
          height="20"
          style="border: none"
      /></a>
      <script
        type="text/javascript"
        src="https://b.st-hatena.com/js/bookmark_button.js"
        charset="utf-8"
        async="async"
      ></script>
        <iframe
          src="https://www.facebook.com/plugins/share_button.php?href=https%3a%2f%2fdwango.github.io%2farticles%2ftrista-inside%2f&layout=button&size=small&mobile_iframe=false&width=61&height=20&appId"
          height="20"
          width="69"
          style="border: none; overflow: hidden"
          scrolling="no"
          frameborder="0"
          allowTransparency="true"
        ></iframe>
      </div>
    </div>
  </div>

    </main>

    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LF3Z3TQ34F"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LF3Z3TQ34F', { 'anonymize_ip': false });
}
</script>

    
  </body>
</html>
