<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="generator" content="Hugo 0.58.0" />

  <meta property="og:title" content="ツールを作ってみよう - dwango on GitHub">

  <meta property="og:image" content="https://dwango.github.io/images/logo.png">

  


  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>ツールを作ってみよう - dwango on GitHub</title>

  
  <link rel="stylesheet" href="https://dwango.github.io/css/print.css" media="print">
  <link rel="stylesheet" href="https://dwango.github.io/css/poole.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://dwango.github.io/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="dwango on GitHub" />
</head>

  <body class="theme-dwango ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://dwango.github.io/"><h1>dwango on GitHub</h1></a>
      <p class="lead">
       
 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="https://dwango.github.io/">Home</a> </li>
      <li><a href="/articles"> Articles </a></li><li><a href="https://dwango.github.io/oss"> OSS </a></li><li><a href="/niconico"> niconico </a></li><li><a href="https://vrm.dev/"> VRM </a></li><li><a href="https://nico.ms/job/"> Hiring </a></li><li><a href="https://dmv.nico/ja/"> Dwango Media Village </a></li>
    </ul>

    <p>
      
        <p style="display:inline-block;vertical-align:middle;">
          Copyright &copy; DWANGO Co., Ltd.
        </p>
      
    </p>
  </div>
</div>

    <div class="content container">
    
<div class="post">
  <h1>ツールを作ってみよう</h1>
  <span class="post-date"> Thu, Nov 1, 2018 </span>
  <div class="share">
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="ツールを作ってみよう - dwango on GitHub" data-url="https://dwango.github.io/niconico/jikken-housou/akashic-content2/" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <a href="http://b.hatena.ne.jp/entry/https://dwango.github.io/niconico/jikken-housou/akashic-content2/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label-counter" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3a%2f%2fdwango.github.io%2fniconico%2fjikken-housou%2fakashic-content2%2f&layout=button&size=small&mobile_iframe=false&width=61&height=20&appId" width="61" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
  </div>
  <div>
    
    <article id="content">
       

<hr />

<p>この文書は 2018 年当時のものです。</p>

<p>最新のニコ生ゲーム作成については <strong><a href="https://akashic-games.github.io/shin-ichiba/">https://akashic-games.github.io/shin-ichiba/</a></strong> をご参照ください。</p>

<hr />

<h2 id="本ページの内容">本ページの内容</h2>

<p>本ページは、2018年10月25日～2018年12月14日（結果発表は2019年01月26日）までかけて行われる（行われた）、<a href="http://ch.nicovideo.jp/indies-game2019/blomaga/ar1687936">ニコニコ自作ゲームフェス新人賞　「実験放送ゲーム部門」</a>に合わせて制作された特集記事の第2回目です。</p>

<h2 id="はじめに">はじめに</h2>

<p>ドワンゴの、主に実験放送のコンテンツ制作に携わっているエンジニアのツゲハラと申します。</p>

<p>実験放送でニコニコ新市場を通して利用できるコンテンツ群（以後ニコニコ新市場対応コンテンツ）が、2018年10月25日より自分達で作れるようになりました。</p>

<p>皆様がスムーズに制作に挑める助力になればと、制作ガイドとなりそうな記事を公開させていただいております。この記事は、この一連の記事の第2回になります。今回から、記事の対象がプログラミング経験者向きとなります。</p>

<ul>
<li>2018年10月25日: <a href="../akashic-content1/">泥棒バスターを改造してみよう</a></li>
<li>2018年11月01日: ツールを作ってみよう（この記事です）</li>
<li>2018年11月08日: <a href="../akashic-content3/">ゲームを作ってみよう</a></li>
</ul>

<p>ニコニコ新市場対応コンテンツについてのご不明点などがあれば、お気軽にお問合せください。</p>

<ul>
<li>公式Twitterカウント: <a href="https://twitter.com/akashic_talk">@akashic_talk</a></li>
</ul>

<h2 id="準備">準備</h2>

<p><a href="../akashic-content1/">第1回</a>を参考に、Akashicの環境を用意しましょう。</p>

<p>今回は改造ではないので、新規にプロジェクトを作るところから実施します。</p>

<p>参考となるAkashic本家の記事はこちらです。</p>

<ul>
<li><a href="https://akashic-games.github.io/tutorial/v2/1-introduction.html">https://akashic-games.github.io/tutorial/v2/1-introduction.html</a></li>
</ul>

<p>まずは、第1回同様、CUIツールを起動します。</p>

<p>適当な作業場所のフォルダに<code>cd</code>コマンドで移ってください。仮に<code>c:\akashic</code>というところに移るものとします。以下のようなコマンドになります。</p>

<pre><code class="language-sh">c:
cd \akashic
</code></pre>

<p>ここに、今回のゲーム用のフォルダを用意したいと思います。以下のコマンドを実行してください。</p>

<pre><code class="language-sh">mkdir tool
cd tool
</code></pre>

<p><code>mkdir</code>で<code>tool</code>というフォルダを作り、<code>cd</code>で作業場所フォルダを作成した新しいフォルダにしたので、このフォルダでAkashicのセットアップしてみたいと思います。</p>

<p>以下のコマンドを実行してください（実行には、第１回でインストールした<code>@akashic/akashic-cli</code>というツールが必要です。まだの人は <code>npm i -g @akashic/akashic-cli</code> などでインストールしてから実行してください）。</p>

<pre><code class="language-sh">akashic init
</code></pre>

<p>このコマンドを実行すると、対話型のインターフェースで色々聞かれると思いますが、それぞれ以下のように入力してEnterを押してください。</p>

<table>
<thead>
<tr>
<th>項目</th>
<th>入力値</th>
<th>備考</th>
</tr>
</thead>

<tbody>
<tr>
<td>width:(320)</td>
<td>640</td>
<td>横幅</td>
</tr>

<tr>
<td>height:(320)</td>
<td>360</td>
<td>縦幅</td>
</tr>

<tr>
<td>fps:(30)</td>
<td>（入力せずそのまま）</td>
<td>フレームレート</td>
</tr>
</tbody>
</table>

<p><code>width</code>は横幅、<code>height</code>は縦幅で、今回は放送で利用するツールを作りたいので、ニコニコ生放送の一般的な解像度である16:9でツールを作成します。この解像度比率にしておけば、映像とぴったり合ったサイズのコンテンツを作成できます。</p>

<p><code>width</code>や<code>height</code>に表示されている<code>(320)</code>や<code>fps</code>の<code>(30)</code>はデフォルト値を意味しているので、<code>fps</code>はそのままEnterを押してもらう事で30fpsになります。</p>

<p>この状態で一度<code>akashic-sandbox</code>を実行してみましょう。</p>

<pre><code class="language-sh">akashic-sandbox
</code></pre>

<p><a href="http://localhost:3000">http://localhost:3000</a> にアクセスすると、赤い四角が延々と右に行くだけのゲーム？が実行出来ていると思います。</p>

<img src="https://dwango.github.io/images/akashic-content2/akashic-rect.png" alt="赤い四角"  />


<p>この時、今回作成したフォルダをエクスプローラで眺めてみると、各種ファイルが自動生成されています。以下のようなファイル群になります。</p>

<table>
<thead>
<tr>
<th>ファイル、フォルダ名</th>
<th>開設</th>
<th>備考</th>
</tr>
</thead>

<tbody>
<tr>
<td>game.json</td>
<td>ゲームの各種情報を記述しているファイルです。<code>width</code>、<code>height</code>、<code>fps</code>等の情報もこちらに記載されています。</td>
<td></td>
</tr>

<tr>
<td>package.json</td>
<td>この記事では利用しません。</td>
<td></td>
</tr>

<tr>
<td>README.md</td>
<td>この記事では利用しません。</td>
<td></td>
</tr>

<tr>
<td>audio</td>
<td>この記事では利用しません。</td>
<td>音声ファイルを格納するためのフォルダです。</td>
</tr>

<tr>
<td>image</td>
<td>画像ファイルを格納するためのフォルダです。</td>
<td></td>
</tr>

<tr>
<td>script</td>
<td>スクリプトを格納するためのフォルダです。</td>
<td></td>
</tr>

<tr>
<td>script\main.js</td>
<td>赤い四角を横に動かすためのコードが入っているスクリプトです。</td>
<td></td>
</tr>

<tr>
<td>text</td>
<td>この記事では利用しません。</td>
<td>テキストファイルを格納するためのフォルダです。</td>
</tr>
</tbody>
</table>

<p>※<code>.gitkeep</code>、<code>.eslint.json</code>というファイルも作成されていますが、環境によっては表示されないこともあるため割愛しています。</p>

<p>なお、<a href="https://www.typescriptlang.org">TypeScript</a>で書きたいという方は、以下のコマンドを利用してセットアップする事もできます。</p>

<pre><code class="language-sh">akashic init -t typescript
npm i
</code></pre>

<p>本記事では、JavaScriptのまま記述を続けますが、以下の理由でTypeScriptの採用も検討の余地があると思います。</p>

<ul>
<li>Visual Studio Code + TypeScriptで書くと、Akashic Engineの型を推測しながら記述できる</li>
<li>AkashicはECMAScript 5th editionで書く必要があり、<code>let</code>や<code>const</code>等を利用して動かなくなる問題を防ぐ事ができる</li>
</ul>

<p>TypeScript版もJavaScript版も、node.jsの経験のある方であれば<code>package.json</code>にスクリプトも記述してあり、<code>npm start</code>や<code>npm run lint</code>などのコマンドに対応しているのも確認できると思います。機会があればTypeScript、node.js、<code>npm</code>周りを活用していくと制作の幅が広がるので、試してみてください。</p>

<h2 id="画像を扱ってみる">画像を扱ってみる</h2>

<p>さて、赤い四角ではさすがに味気ないので、画像を登場させましょう。</p>

<p>この記事ではこちらのハートを用いてみたいと思いますが、皆さんもよかったらお手元で「64 x 64の背景が透明なPNG」を適当な内容でご用意ください。</p>

<img src="https://dwango.github.io/images/akashic-content2/heart.png" alt="ハート"  />


<p>画像を扱う際のAkashicの公式チュートリアルはこちらになりますが、本記事でも制作に必要な要点に絞って記載を続けていきます。</p>

<ul>
<li><a href="https://akashic-games.github.io/tutorial/v2/2-basic.html#%E7%94%BB%E5%83%8F%E3%82%92%E6%89%B1%E3%81%86">https://akashic-games.github.io/tutorial/v2/2-basic.html#%E7%94%BB%E5%83%8F%E3%82%92%E6%89%B1%E3%81%86</a></li>
</ul>

<p>まず、このファイルを<code>image</code>フォルダに配置します。<code>c:\akashic\tool\image\heart.png</code>というファイルがある状態にした上で、CUIツールをcdなどで<code>c:\akashic\tool</code>に移動させた後、以下のコマンドを実行してください。</p>

<pre><code class="language-sh">akashic scan asset
</code></pre>

<p>以下のような表示が出れば成功です。</p>

<pre><code class="language-sh">C:\akashic\tool&gt;akashic scan asset
INFO: Added/updated the declaration for heart (image/heart.png)
INFO: Done!
</code></pre>

<p>この時に<code>game.json</code>の中身を覗いてみると、<code>assets</code>というものの中に<code>heart</code>というリソースが追加されている様子がなんとなく見てとれます。</p>

<p><code>game.json</code> はテキストエディタ等で開く事ができます。テキストエディタをお持ちでない方は、<a href="https://code.visualstudio.com">Visual Studio Code</a>辺りをインストールしてから開く事をお勧めします。</p>

<pre><code class="language-json">{
	&quot;width&quot;: 640,
	&quot;height&quot;: 360,
	&quot;fps&quot;: 30,
	&quot;main&quot;: &quot;./script/main.js&quot;,
	&quot;assets&quot;: {
		&quot;main&quot;: {
			&quot;type&quot;: &quot;script&quot;,
			&quot;path&quot;: &quot;script/main.js&quot;,
			&quot;global&quot;: true
		},
		&quot;heart&quot;: {
			&quot;type&quot;: &quot;image&quot;,
			&quot;width&quot;: 64,
			&quot;height&quot;: 64,
			&quot;path&quot;: &quot;image/heart.png&quot;
		}
	},
	&quot;environment&quot;: {
		&quot;sandbox-runtime&quot;: &quot;2&quot;
	}
}
</code></pre>

<p>これで画像の利用準備が整いました！いよいよAkashicの対応コードを書いてみたいと思います。</p>

<p><code>script\main.js</code> を手元のテキストエディタで開いてください。<code>main.js</code>は現状以下の内容になっています。</p>

<pre><code class="language-javascript">function main(param) {
	var scene = new g.Scene({game: g.game});
	scene.loaded.add(function() {
		// 以下にゲームのロジックを記述します。
		var rect = new g.FilledRect({
			scene: scene,
			cssColor: &quot;#ff0000&quot;,
			width: 32,
			height: 32
		});
		rect.update.add(function () {
			// 以下のコードは毎フレーム実行されます。
			rect.x++;
			if (rect.x &gt; g.game.width) rect.x = 0;
			rect.modified();
		});
		scene.append(rect);
	});
	g.game.pushScene(scene);
}
module.exports = main;
</code></pre>

<p>ここまではプログラミング未経験の方でも読める内容でしたが、いよいよソースコードも登場しましたので、ここから経験者でないと難しい内容になってきます。具体的には、以下のような説明を省略し、Akashic固有の部分のみ記述します。</p>

<ul>
<li>変数、関数、配列、クラス</li>
<li><code>new</code>、<code>++</code>等の演算子</li>
<li>JavaScriptの基本構文</li>
</ul>

<p>Akashicは、ゲームの中には複数のシーンがあり、シーンの中に複数のエンティティがある、という基本構造をとっています。</p>

<p>エンティティについては<a href="https://akashic-games.github.io/tutorial/v2/2-basic.html#%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3">公式のチュートリアル</a>からの以下を説明として抜粋します。</p>

<blockquote>
<p>画像や文字列などシーン上で描画されるオブジェクトを Akashic Engine ではエンティティと呼びます。</p>
</blockquote>

<p>エンティティを描画するには、まずシーンが必要です。</p>

<p>先ほどのコードでは以下のようにシーンを作成しています。</p>

<pre><code class="language-javascript">var scene = new g.Scene({game: g.game});
// ～ 中略 ～
g.game.pushScene(scene);
</code></pre>

<p><code>scene</code>変数に<code>g.Scene</code>というエンティティのインスタンスを格納し、最後にゲームに対して<code>scene</code>変数を追加しています。</p>

<p>このシーンに、先ほど追加した<code>heart</code>という画像を追加してあげましょう。</p>

<pre><code class="language-javascript">var scene = new g.Scene({game: g.game, assetIds: [&quot;heart&quot;]});
</code></pre>

<p><code>g.Scene</code>初期化時に<code>assetIds</code>というパラメータを<code>&quot;heart&quot;</code>という文字列が含まれている配列で渡します。</p>

<p>この<code>heart</code>という文字列が先ほどの画像に紐付くという定義が、<code>game.json</code>に記述されていますので、これで画像を登場させる準備が整いました。</p>

<p>これから、このハート画像を登場させるコードをサンプルのコードにある以下のコードの下に記述していきます。</p>

<pre><code class="language-javascript">scene.append(rect);
</code></pre>

<p><code>Sprite</code>というエンティティを利用するコードを追加します。<code>Sprite</code>は画像を扱う際にもっとも基本となるエンティティです。（一番上の行は、ここから追加するという事を意味しているだけですので、追加しないでください）</p>

<pre><code class="language-javascript">scene.append(rect);
var sprite = new g.Sprite({
	scene: scene,
	src: scene.assets[&quot;heart&quot;]
});
scene.append(sprite);
</code></pre>

<p>コードを書き換えたら、また<code>akashic-sandbox</code>を実行して確認してみましょう。以下のような表示になるはずです。</p>

<img src="https://dwango.github.io/images/akashic-content2/heart-and-akashic-rect.png" alt="ハートと赤い四角"  />


<p>無事ハートが登場しました！・・しかしちょっと後ろの赤い四角が邪魔ですね。</p>

<p><code>FilledRect</code>というエンティティを操作するサンプルコードが入っているためなので、消してしまいましょう。最終的には以下のコードになります。</p>

<pre><code class="language-javascript">function main(param) {
	var scene = new g.Scene({game: g.game, assetIds: [&quot;heart&quot;]});
	scene.loaded.add(function() {
		var sprite = new g.Sprite({
			scene: scene,
			src: scene.assets[&quot;heart&quot;]
		});
		scene.append(sprite);
	});
	g.game.pushScene(scene);
}
module.exports = main;
</code></pre>

<p>これで、画像が一枚登場して何も動かないだけのツール？になりました。</p>

<p>この節で登場したエンティティの詳しい説明は、公式のリファレンスを参照してください。</p>

<ul>
<li><code>FilledRect</code>: <a href="https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.filledrect.html">https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.filledrect.html</a></li>
<li><code>Sprite</code>: <a href="https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.sprite.html">https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.sprite.html</a></li>
</ul>

<h2 id="入力を扱ってみる">入力を扱ってみる</h2>

<p>さて、固定の画像を表示して「ウォーターマーク表示ツール」等と名乗ってもよいのですが、さすがに寂しいので、入力くらい扱えるようにしたいですね。この節では、「タッチした場所にハートマークが表示される」という機能を実現したいと思います。</p>

<p>最初に、「タッチした」というイベントをとる必要があります。</p>

<p>イベントを取る方法はエンティティのイベントを取る方法と、シーン全体でイベントを取る方法の2種類があるのですが、今回は「どこにタッチしてもその場所にハートが出てくる」という形にしたいので、シーン全体のイベントを取る方法を採用します。</p>

<p>タッチしたイベントをとるには、トリガーと呼ばれる機構を利用します。「そのシーンでタッチが発生した」というイベントを取るため、<code>pointDownCapture</code>というトリガーを利用します。詳細は公式のリファレンスやチュートリアルを参照してください。</p>

<ul>
<li>チュートリアル: <a href="https://akashic-games.github.io/tutorial/v2/4-click.html">https://akashic-games.github.io/tutorial/v2/4-click.html</a></li>
<li>リファレンス: <a href="https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.scene.html#pointdowncapture">https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.scene.html#pointdowncapture</a></li>
</ul>

<p>要素が多いので、個別に説明する前にコード全体を見てから、この後で解説するようにしたいと思います。まずはコード全体を見てみましょう。</p>

<pre><code class="language-javascript">function main(param) {
	var scene = new g.Scene({game: g.game, assetIds: [&quot;heart&quot;]});
	scene.loaded.add(function() {
		var sprite = new g.Sprite({
			scene: scene,
			src: scene.assets[&quot;heart&quot;]
		});
		scene.append(sprite);
		// -- 「入力を扱ってみる」で追加
		// pointDownCaptureトリガーに関数を登録
		scene.pointDownCapture.add(function(e) {
			// heart変数にheart画像のSpriteを追加
			var heart = new g.Sprite({
				scene: scene,
				src: scene.assets[&quot;heart&quot;]
			});
			// heartの位置をタッチされた場所にする。Akashicの基準座標は左上なので、タッチされた中心になるように微調整する
			heart.moveTo(
				e.point.x - heart.width / 2,
				e.point.y - heart.height / 2
			);
			// 作成したheartスプライトをシーンに追加
			scene.append(heart);
		});
		// ここまで「入力を扱ってみる」 --
	});
	g.game.pushScene(scene);
}

module.exports = main;
</code></pre>

<p><code>-- 「入力を扱ってみる」で追加</code>と書かれているところが該当コードで、コード内にコメントも書いておきました。</p>

<p>要点を解説していきます。</p>

<p><code>pointDownCapture</code>トリガーの<code>add</code>メソッドでイベントハンドラを登録し、</p>

<pre><code class="language-javascript">scene.pointDownCapture.add(function(e) {
</code></pre>

<p>タッチされたら、<code>Sprite</code>を生成します。</p>

<pre><code class="language-javascript">var heart = new g.Sprite({
	scene: scene,
	src: scene.assets[&quot;heart&quot;]
});
</code></pre>

<p><code>moveTo</code>メソッドで位置を調整し、この際イベントハンドラに渡ってくる変数<code>e</code>の中に入っている<code>point</code>変数から座標を計算しています。</p>

<pre><code class="language-javascript">heart.moveTo(
	e.point.x - heart.width / 2,
	e.point.y - heart.height / 2
);
</code></pre>

<p>コメントにも記載があるように、Akashicの座標は左上を起点としているため、<code>point</code>変数の値をそのまま利用していますと、思ったより右下に配置されてしまいます。</p>

<p>タッチされたポイントの中心に置くように、<code>Sprite</code>のサイズを基に位置を微調整し、最後に調整済の<code>Sprite</code>をシーンに追加しています。</p>

<p>実行し、タッチをするとSpriteが増えてこのような絵面のツール？が実行できているかと思います。</p>

<img src="https://dwango.github.io/images/akashic-content2/multi-heart.png" alt="複数のハート"  />


<h2 id="一定時間で削除する">一定時間で削除する</h2>

<p>これで完成、としてもいいのですが、さすがにこのまま放送で使うと画面がハートで埋まってしまいます。</p>

<p>放送画面をデコるツール、という事にしてもいいのですが、もう少し踏み込んで一定時間で削除する機能を入れたいと思います。</p>

<p>先にコードを見てみましょう。</p>

<pre><code class="language-javascript">function main(param) {
	var scene = new g.Scene({game: g.game, assetIds: [&quot;heart&quot;]});
	scene.loaded.add(function() {
		var sprite = new g.Sprite({
			scene: scene,
			src: scene.assets[&quot;heart&quot;]
		});
		scene.append(sprite);
		// -- 「入力を扱ってみる」で追加
		// pointDownCaptureトリガーに関数を登録
		scene.pointDownCapture.add(function(e) {
			// heart変数にheart画像のSpriteを追加
			var heart = new g.Sprite({
				scene: scene,
				src: scene.assets[&quot;heart&quot;]
			});
			// heartの位置をタッチされた場所にする。Akashicの基準座標は左上なので、タッチされた中心になるように微調整する
			heart.moveTo(
				e.point.x - heart.width / 2,
				e.point.y - heart.height / 2
			);
			// -- 「一定時間で削除する」で追加
			// heartのtagという変数にcounterを格納
			heart.tag = {
				counter: 0
			};
			// 毎フレーム実行されるイベントであるupdateにイベントを登録
			heart.update.add(function(e) {
				// 毎フレームカウンタを追加
				heart.tag.counter++;
				if (heart.tag.counter &gt; 100) {
					// カウンタが100を超えていたら削除する
					heart.destroy();
				} else if (heart.tag.counter &gt; 50) {
					// カウンタが50を超えていたら半透明にしていく
					heart.opacity = (100 - heart.tag.counter) / 50;
					// このエンティティが変更されたという通知
					heart.modified();
				}
			});
			// ここまで「一定時間で削除する」で追加 --
			// 作成したheartスプライトをシーンに追加
			scene.append(heart);
		});
		// ここまで「入力を扱ってみる」 --
	});
	g.game.pushScene(scene);
}

module.exports = main;
</code></pre>

<p><code>-- 「一定時間で削除する」で追加</code>以降が追加分です。</p>

<p>エンティティごとに削除したいので、まずはエンティティ単位の変数にカウンタの値を入れています。</p>

<pre><code class="language-javascript">heart.tag = {
	counter: 0
};
</code></pre>

<p>エンティティ単位の変数を確保する方法は色々とあるのですが、TypeScriptなどを利用して型を厳密に定義した場合でも運用しやすいよう、今回は<code>tag</code>というところにオブジェクトを入れ、そのオブジェクトの変数に<code>counter</code>という値を持たせる形にしました。</p>

<p><code>tag</code>についてはリファレンスにも記載があるので、必要に応じてそちらも参照してください。</p>

<ul>
<li><a href="https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.e.html#tag">https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.e.html#tag</a></li>
</ul>

<p>次に、毎フレーム実行されるイベントを利用する為、<code>update</code>というトリガーにイベントハンドラを登録しています。</p>

<pre><code class="language-javascript">heart.update.add(function(e) {
</code></pre>

<p>この<code>update</code>トリガーは、赤い四角を右に動かしていたサンプルコードも使っていたトリガーです。このトリガーに登録されたイベントハンドラは、毎フレーム実行されます。</p>

<p>3秒ちょっとで消える事にしました。100フレームを30fpsで考えると3.3秒なので、100フレーム辺りで制御しようと思います。</p>

<p>また、最初の50フレームは変化なくそのままで、50フレームからだんだん半透明にする事にしました。それをコードで表したのがこちらです。</p>

<pre><code class="language-javascript">if (heart.tag.counter &gt; 100) {
	// カウンタが100を超えていたら削除する
	heart.destroy();
} else if (heart.tag.counter &gt; 50) {
	// カウンタが50を超えていたら半透明にしていく
	heart.opacity = (100 - heart.tag.counter) / 50;
	// このエンティティが変更されたという通知
	heart.modified();
}
</code></pre>

<p>100フレームを超えていたら<code>destroy</code>を呼び出しています。Akashicのエンティティを削除する方法は<code>remove</code>と<code>destroy</code>の二つがあるのですが、<code>remove</code>だけだとイベントハンドラ等は解除されないので、<code>destroy</code>で存在ごと消滅させています。</p>

<p>50フレームを超えていたら、<code>opacity</code>というプロパティを操作して、透明度を操作しています。<code>opacity</code>は<code>0</code>～<code>1.0</code>で透明度を指定するので、式でだんだん透明度を上げていく形にしました。</p>

<p>最後の<code>modified</code>はAkashicで「このエンティティが変更された」という宣言をするためのメソッドです。このメソッドを呼び出さないと、プロパティの変更が正しく画面に反映されないため、<code>opacity</code>の変更を描画するために呼び出しています。</p>

<p>最後、左上に最初からいるハートが邪魔ですね。この辺りの仕上げはみなさんのお手元で実際にやっていただくのがいいと思いますが、私はこうしました。皆さんも工夫してみてください。</p>

<pre><code class="language-javascript">function main(param) {
	var scene = new g.Scene({game: g.game, assetIds: [&quot;heart&quot;]});
	scene.loaded.add(function() {
		function generateHeart(x, y) {
			// heart変数にheart画像のSpriteを追加
			var heart = new g.Sprite({
				scene: scene,
				src: scene.assets[&quot;heart&quot;]
			});
			// heartの位置をタッチされた場所にする。Akashicの基準座標は左上なので、タッチされた中心になるように微調整する
			heart.moveTo(
				x,
				y
			);
			// heartのtagという変数にcounterを格納
			heart.tag = {
				counter: 0
			};
			// 毎フレーム実行されるイベントであるupdateにイベントを登録
			heart.update.add(function(e) {
				// 毎フレームカウンタを追加
				heart.tag.counter++;
				if (heart.tag.counter &gt; 100) {
					// カウンタが100を超えていたら削除する
					heart.destroy();
				} else if (heart.tag.counter &gt; 50) {
					// カウンタが50を超えていたら半透明にしていく
					heart.opacity = (100 - heart.tag.counter) / 50;
					// このエンティティが変更されたという通知
					heart.modified();
				}
			});
			// 作成したheartスプライトをシーンに追加
			scene.append(heart);
		}
		// pointDownCaptureトリガーに関数を登録
		scene.pointDownCapture.add(function(e) {
			// タッチされたらハートを中心点に配置する
			generateHeart(
				e.point.x - scene.assets[&quot;heart&quot;].width / 2,
				e.point.y - scene.assets[&quot;heart&quot;].height / 2
			);
		});


		// 最初に中心にハートを出現させる
		generateHeart(
			g.game.width / 2 - scene.assets[&quot;heart&quot;].width / 2,
			g.game.height / 2 - scene.assets[&quot;heart&quot;].height / 2
		);
	});
	g.game.pushScene(scene);
}

module.exports = main;
</code></pre>

<p>以下は完成体を実行している様子です。放送者が画面中央にいる事を想像しながら見ると、ツールっぽくなっているのではないでしょうか。</p>

<img src="https://dwango.github.io/images/akashic-content2/heart-final.png" alt="最終的なハートツール"  />


<h2 id="完成と投稿">完成と投稿</h2>

<p>最後にアツマールに投稿しておきたいと思います。以下の文書を参考にします。</p>

<ul>
<li>ニコニコ新市場対応コンテンツ作成ガイド: <a href="https://akashic-games.github.io/guide/ranking.html">https://akashic-games.github.io/guide/ranking.html</a></li>
<li>ニコニコ新市場対応コンテンツの投稿方法; <a href="https://akashic-games.github.io/guide/export-atsumaru.html">https://akashic-games.github.io/guide/export-atsumaru.html</a></li>
</ul>

<p>「ニコニコ新市場対応コンテンツ作成ガイド」に従い、<code>game.json</code>に以下の記述を加えます。これはツールなのでランキングには対応しませんので、<code>&quot;single&quot;</code>にのみ対応します。</p>

<pre><code class="language-json">&quot;niconico&quot;: {
	&quot;supportedModes&quot;: [&quot;single&quot;]
}
</code></pre>

<p>最終的に、game.jsonは以下のようになっていると思います。</p>

<pre><code class="language-json">{
	&quot;width&quot;: 640,
	&quot;height&quot;: 360,
	&quot;fps&quot;: 30,
	&quot;main&quot;: &quot;./script/main.js&quot;,
	&quot;assets&quot;: {
		&quot;main&quot;: {
			&quot;type&quot;: &quot;script&quot;,
			&quot;path&quot;: &quot;script/main.js&quot;,
			&quot;global&quot;: true
		},
		&quot;heart&quot;: {
			&quot;type&quot;: &quot;image&quot;,
			&quot;width&quot;: 64,
			&quot;height&quot;: 64,
			&quot;path&quot;: &quot;image/heart.png&quot;
		}
	},
	&quot;environment&quot;: {
		&quot;sandbox-runtime&quot;: &quot;2&quot;,
		&quot;niconico&quot;: {
			&quot;supportedModes&quot;: [&quot;single&quot;]
		}
	}
}
</code></pre>

<p>続いて、「ニコニコ新市場対応コンテンツの投稿方法」に従い、以下のコマンドをCUIツールから実行します。</p>

<pre><code class="language-sh">akashic export html --output atsumaru.zip --atsumaru
</code></pre>

<p>あとはRPGアツマールのページに行き、「ゲーム投稿」を押して、ZIPファイルをアップロードします。</p>

<p>ゲーム名、アイコン、ジャンル、紹介文が最低限必要です。アイコンは<code>320x320</code>がおすすめです。この辺りを適当に入力して、公開すると、アツマールへの投稿が完了します。</p>

<ul>
<li><a href="https://game.nicovideo.jp/atsumaru/games/gm8700">https://game.nicovideo.jp/atsumaru/games/gm8700</a></li>
</ul>

<p>アツマール投稿後、自身のページに表示されるゲーム一覧の「その他」メニューから「ニコニコ新市場に登録申請」を選ぶ事で、登録申請をすることができます。</p>

<img src="https://dwango.github.io/images/akashic-content2/tourokushinsei.png" alt="登録申請"  />


<p>RPGアツマールへの投稿は<a href="https://game.nicovideo.jp/atsumaru/game/edit/new">こちら</a>からできます。是非皆さんも挑戦してみてください。</p>

<h2 id="今後の手引き">今後の手引き</h2>

<p>今回は、簡単なツールの作成を行いましたが、こういったツールであればあるほど演出面をこだわりたいという話が出てくると思います。</p>

<p>以下に、演出強化のためによく使いそうな文書やライブラリについて、リンク集を置いておきます。今後の参考ということで、必要に応じてご参照ください。</p>

<ul>
<li>アニメーションをさせたい場合

<ul>
<li>アニメーションに関する公式文書

<ul>
<li><a href="https://akashic-games.github.io/tutorial/v2/3-animation.html">https://akashic-games.github.io/tutorial/v2/3-animation.html</a></li>
</ul></li>
<li>FrameSprite（いわゆるスプライトシートを使いたい場合）

<ul>
<li><a href="https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.framesprite.html">https://akashic-games.github.io/reference/akashic-engine-v2/classes/_lib_main_d_.g.framesprite.html</a></li>
</ul></li>
<li>Akashic Timeline（イージング等をかけて動かす場合）

<ul>
<li><a href="https://github.com/akashic-games/akashic-timeline">https://github.com/akashic-games/akashic-timeline</a></li>
</ul></li>
<li>Akashic Animation（より複雑なアニメーション）

<ul>
<li><a href="https://github.com/akashic-games/akashic-animation">https://github.com/akashic-games/akashic-animation</a></li>
</ul></li>
</ul></li>
<li>音をつけたい場合

<ul>
<li><a href="https://akashic-games.github.io/tutorial/v2/5-audio.html">https://akashic-games.github.io/tutorial/v2/5-audio.html</a></li>
</ul></li>
<li>文字列を扱いたい場合

<ul>
<li>簡単な文字列の描画

<ul>
<li><a href="https://akashic-games.github.io/tutorial/v2/6-otherdraw.html#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E8%A1%A8%E7%A4%BA">https://akashic-games.github.io/tutorial/v2/6-otherdraw.html#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E8%A1%A8%E7%A4%BA</a></li>
</ul></li>
<li>複雑な文字列の描画

<ul>
<li><a href="https://github.com/akashic-games/akashic-label">https://github.com/akashic-games/akashic-label</a></li>
</ul></li>
</ul></li>
</ul>

<p>長い記事でしたが、ここまで読んでくださりありがとうございました。</p>

<p>本記事では導入部のみですが、本記事をとっかかりに、皆さんも是非様々な生放送向けツールの制作に挑戦してみてください。</p>

<p>次回は、いよいよゲームの作成になります。また次回もよろしくお願いします。</p>

<hr />

<p>本記事でご紹介したソースコードは、すべて以下のURLで公開されています。素材、ソースコードいずれも二次利用が可能ですので、ご活用ください。</p>

<ul>
<li><a href="https://github.com/akashic-contents/heart-tool">https://github.com/akashic-contents/heart-tool</a></li>
</ul>

    </article>
  </div>
</div>

    </div>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-109076308-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>